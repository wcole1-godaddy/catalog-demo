{
 "Resources": {
  "aiAssistantapiLB21824883": {
   "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
   "Properties": {
    "LoadBalancerAttributes": [
     {
      "Key": "deletion_protection.enabled",
      "Value": "false"
     },
     {
      "Key": "idle_timeout.timeout_seconds",
      "Value": "301"
     },
     {
      "Key": "access_logs.s3.enabled",
      "Value": "true"
     },
     {
      "Key": "access_logs.s3.bucket",
      "Value": "gd-access-commerceut-test-logs-us-west-2-ilmzy6d34"
     },
     {
      "Key": "access_logs.s3.prefix",
      "Value": "alb"
     }
    ],
    "Name": "aiAssistant-load-balancer",
    "Scheme": "internet-facing",
    "SecurityGroups": [
     {
      "Fn::GetAtt": [
       "aiAssistantapiLBSecurityGroup8AAE2195",
       "GroupId"
      ]
     }
    ],
    "Subnets": [
     "subnet-092c0c4c7707b88e9",
     "subnet-03b2f61766b519864"
    ],
    "Tags": [
     {
      "Key": "BudgetId",
      "Value": "001297-04"
     },
     {
      "Key": "doNotShutDown",
      "Value": "true"
     },
     {
      "Key": "Env",
      "Value": "test"
     },
     {
      "Key": "LegalOU",
      "Value": "USA"
     },
     {
      "Key": "OrgOU",
      "Value": "GD"
     },
     {
      "Key": "Team",
      "Value": "commerceut"
     }
    ],
    "Type": "application"
   },
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/LB/Resource"
   }
  },
  "aiAssistantapiLBSecurityGroup8AAE2195": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "Automatically created Security Group for ELB aiasstv2ecspatternsstackaiAssistantapiLBD0AB8E6F",
    "SecurityGroupIngress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow from anyone on port 443",
      "FromPort": 443,
      "IpProtocol": "tcp",
      "ToPort": 443
     }
    ],
    "Tags": [
     {
      "Key": "BudgetId",
      "Value": "001297-04"
     },
     {
      "Key": "doNotShutDown",
      "Value": "true"
     },
     {
      "Key": "Env",
      "Value": "test"
     },
     {
      "Key": "LegalOU",
      "Value": "USA"
     },
     {
      "Key": "OrgOU",
      "Value": "GD"
     },
     {
      "Key": "Team",
      "Value": "commerceut"
     }
    ],
    "VpcId": "vpc-0531a5bc0caa4db81"
   },
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/LB/SecurityGroup/Resource"
   }
  },
  "aiAssistantapiLBSecurityGrouptoaiasstv2ecspatternsstackaiAssistantapiServiceSecurityGroup328A3D7084430FFE9E85": {
   "Type": "AWS::EC2::SecurityGroupEgress",
   "Properties": {
    "Description": "Load balancer to target",
    "DestinationSecurityGroupId": {
     "Fn::GetAtt": [
      "aiAssistantapiServiceSecurityGroupF0CEC0BC",
      "GroupId"
     ]
    },
    "FromPort": 8443,
    "GroupId": {
     "Fn::GetAtt": [
      "aiAssistantapiLBSecurityGroup8AAE2195",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "ToPort": 8443
   },
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/LB/SecurityGroup/to aiasstv2ecspatternsstackaiAssistantapiServiceSecurityGroup328A3D70:8443"
   }
  },
  "aiAssistantapiLBPublicListenerB04F7803": {
   "Type": "AWS::ElasticLoadBalancingV2::Listener",
   "Properties": {
    "Certificates": [
     {
      "CertificateArn": {
       "Fn::Join": [
        "",
        [
         "arn:",
         {
          "Ref": "AWS::Partition"
         },
         ":acm:us-west-2:761615930507:certificate/634a4dcf-905e-4d47-949d-a5a0af5352b3"
        ]
       ]
      }
     }
    ],
    "DefaultActions": [
     {
      "TargetGroupArn": {
       "Ref": "aiAssistantapiLBPublicListenerECSGroup1FD53857"
      },
      "Type": "forward"
     }
    ],
    "LoadBalancerArn": {
     "Ref": "aiAssistantapiLB21824883"
    },
    "Port": 443,
    "Protocol": "HTTPS",
    "SslPolicy": "ELBSecurityPolicy-TLS-1-2-2017-01"
   },
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/LB/PublicListener/Resource"
   }
  },
  "aiAssistantapiLBPublicListenerECSGroup1FD53857": {
   "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
   "Properties": {
    "Port": 443,
    "Protocol": "HTTPS",
    "Tags": [
     {
      "Key": "BudgetId",
      "Value": "001297-04"
     },
     {
      "Key": "doNotShutDown",
      "Value": "true"
     },
     {
      "Key": "Env",
      "Value": "test"
     },
     {
      "Key": "LegalOU",
      "Value": "USA"
     },
     {
      "Key": "OrgOU",
      "Value": "GD"
     },
     {
      "Key": "Team",
      "Value": "commerceut"
     }
    ],
    "TargetGroupAttributes": [
     {
      "Key": "stickiness.enabled",
      "Value": "false"
     }
    ],
    "TargetType": "ip",
    "VpcId": "vpc-0531a5bc0caa4db81"
   },
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/LB/PublicListener/ECSGroup/Resource"
   }
  },
  "aiAssistantapiTaskDefTaskRole72CFDE60": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PermissionsBoundary": {
     "Fn::Join": [
      "",
      [
       "arn:aws:iam::",
       {
        "Ref": "AWS::AccountId"
       },
       ":policy/GD-AWS-SSG-PB-DEFAULT"
      ]
     ]
    },
    "RoleName": "commerceut-custom-22be6db9beac1e728e594d0a678f9007ab4ade9e",
    "Tags": [
     {
      "Key": "BudgetId",
      "Value": "001297-04"
     },
     {
      "Key": "doNotShutDown",
      "Value": "true"
     },
     {
      "Key": "Env",
      "Value": "test"
     },
     {
      "Key": "LegalOU",
      "Value": "USA"
     },
     {
      "Key": "OrgOU",
      "Value": "GD"
     },
     {
      "Key": "roleType",
      "Value": "SSG-Custom"
     },
     {
      "Key": "Team",
      "Value": "commerceut"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/TaskDef/TaskRole/Resource"
   }
  },
  "aiAssistantapiTaskDefTaskRoleDefaultPolicyFA1124D9": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "secretsmanager:GetSecretValue",
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "aiAssistantapiTaskDefTaskRoleDefaultPolicyFA1124D9",
    "Roles": [
     {
      "Ref": "aiAssistantapiTaskDefTaskRole72CFDE60"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/TaskDef/TaskRole/DefaultPolicy/Resource"
   }
  },
  "aiAssistantapiTaskDef841E9965": {
   "Type": "AWS::ECS::TaskDefinition",
   "Properties": {
    "ContainerDefinitions": [
     {
      "Environment": [
       {
        "Name": "NODE_ENV",
        "Value": "test"
       }
      ],
      "Essential": true,
      "Image": {
       "Fn::Join": [
        "",
        [
         "761615930507.dkr.ecr.us-west-2.",
         {
          "Ref": "AWS::URLSuffix"
         },
         "/ai-asst-v2-ecr-repo:latest"
        ]
       ]
      },
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "aiAssistantapiTaskDefaiAssistantContainerLogGroup9DDB7A44"
        },
        "awslogs-stream-prefix": "ai-assistant",
        "awslogs-region": "us-west-2",
        "mode": "non-blocking"
       }
      },
      "Name": "aiAssistantContainer",
      "PortMappings": [
       {
        "ContainerPort": 8443,
        "Protocol": "tcp"
       }
      ]
     }
    ],
    "Cpu": "1024",
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "aiAssistantapiTaskDefExecutionRole81BB02AF",
      "Arn"
     ]
    },
    "Family": "ai-assistant",
    "Memory": "2048",
    "NetworkMode": "awsvpc",
    "RequiresCompatibilities": [
     "FARGATE"
    ],
    "RuntimePlatform": {
     "CpuArchitecture": "ARM64",
     "OperatingSystemFamily": "LINUX"
    },
    "Tags": [
     {
      "Key": "BudgetId",
      "Value": "001297-04"
     },
     {
      "Key": "doNotShutDown",
      "Value": "true"
     },
     {
      "Key": "Env",
      "Value": "test"
     },
     {
      "Key": "LegalOU",
      "Value": "USA"
     },
     {
      "Key": "OrgOU",
      "Value": "GD"
     },
     {
      "Key": "Team",
      "Value": "commerceut"
     }
    ],
    "TaskRoleArn": {
     "Fn::GetAtt": [
      "aiAssistantapiTaskDefTaskRole72CFDE60",
      "Arn"
     ]
    }
   },
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/TaskDef/Resource"
   }
  },
  "aiAssistantapiTaskDefaiAssistantContainerLogGroup9DDB7A44": {
   "Type": "AWS::Logs::LogGroup",
   "Properties": {
    "KmsKeyId": "arn:aws:kms:us-west-2:038365682807:alias/commerceut",
    "Tags": [
     {
      "Key": "BudgetId",
      "Value": "001297-04"
     },
     {
      "Key": "doNotShutDown",
      "Value": "true"
     },
     {
      "Key": "Env",
      "Value": "test"
     },
     {
      "Key": "LegalOU",
      "Value": "USA"
     },
     {
      "Key": "OrgOU",
      "Value": "GD"
     },
     {
      "Key": "Team",
      "Value": "commerceut"
     }
    ]
   },
   "UpdateReplacePolicy": "Retain",
   "DeletionPolicy": "Retain",
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/TaskDef/aiAssistantContainer/LogGroup/Resource"
   }
  },
  "aiAssistantapiTaskDefExecutionRole81BB02AF": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PermissionsBoundary": {
     "Fn::Join": [
      "",
      [
       "arn:aws:iam::",
       {
        "Ref": "AWS::AccountId"
       },
       ":policy/GD-AWS-SSG-PB-DEFAULT"
      ]
     ]
    },
    "RoleName": "commerceut-custom-1239ba46f8fcd7d79727bfd91ec0064da3b0479f",
    "Tags": [
     {
      "Key": "BudgetId",
      "Value": "001297-04"
     },
     {
      "Key": "doNotShutDown",
      "Value": "true"
     },
     {
      "Key": "Env",
      "Value": "test"
     },
     {
      "Key": "LegalOU",
      "Value": "USA"
     },
     {
      "Key": "OrgOU",
      "Value": "GD"
     },
     {
      "Key": "roleType",
      "Value": "SSG-Custom"
     },
     {
      "Key": "Team",
      "Value": "commerceut"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/TaskDef/ExecutionRole/Resource"
   }
  },
  "aiAssistantapiTaskDefExecutionRoleDefaultPolicyB9E20E0B": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "ecr:BatchCheckLayerAvailability",
        "ecr:GetDownloadUrlForLayer",
        "ecr:BatchGetImage"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":ecr:us-west-2:761615930507:repository/ai-asst-v2-ecr-repo"
         ]
        ]
       }
      },
      {
       "Action": "ecr:GetAuthorizationToken",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "aiAssistantapiTaskDefaiAssistantContainerLogGroup9DDB7A44",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "aiAssistantapiTaskDefExecutionRoleDefaultPolicyB9E20E0B",
    "Roles": [
     {
      "Ref": "aiAssistantapiTaskDefExecutionRole81BB02AF"
     }
    ]
   },
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/TaskDef/ExecutionRole/DefaultPolicy/Resource"
   }
  },
  "aiAssistantapiService744392F3": {
   "Type": "AWS::ECS::Service",
   "Properties": {
    "Cluster": "aiAssistantCluster",
    "DeploymentConfiguration": {
     "Alarms": {
      "AlarmNames": [],
      "Enable": false,
      "Rollback": false
     },
     "DeploymentCircuitBreaker": {
      "Enable": true,
      "Rollback": true
     },
     "MaximumPercent": 200,
     "MinimumHealthyPercent": 50
    },
    "DeploymentController": {
     "Type": "ECS"
    },
    "DesiredCount": 2,
    "EnableECSManagedTags": false,
    "HealthCheckGracePeriodSeconds": 15,
    "LaunchType": "FARGATE",
    "LoadBalancers": [
     {
      "ContainerName": "aiAssistantContainer",
      "ContainerPort": 8443,
      "TargetGroupArn": {
       "Ref": "aiAssistantapiLBPublicListenerECSGroup1FD53857"
      }
     }
    ],
    "NetworkConfiguration": {
     "AwsvpcConfiguration": {
      "AssignPublicIp": "DISABLED",
      "SecurityGroups": [
       {
        "Fn::GetAtt": [
         "aiAssistantapiServiceSecurityGroupF0CEC0BC",
         "GroupId"
        ]
       }
      ],
      "Subnets": [
       "subnet-0bd36126a5c1b4ea0",
       "subnet-0e415f4d41891356e"
      ]
     }
    },
    "ServiceName": "aiAssistant-api",
    "Tags": [
     {
      "Key": "BudgetId",
      "Value": "001297-04"
     },
     {
      "Key": "doNotShutDown",
      "Value": "true"
     },
     {
      "Key": "Env",
      "Value": "test"
     },
     {
      "Key": "LegalOU",
      "Value": "USA"
     },
     {
      "Key": "OrgOU",
      "Value": "GD"
     },
     {
      "Key": "Team",
      "Value": "commerceut"
     }
    ],
    "TaskDefinition": {
     "Ref": "aiAssistantapiTaskDef841E9965"
    }
   },
   "DependsOn": [
    "aiAssistantapiLBPublicListenerECSGroup1FD53857",
    "aiAssistantapiLBPublicListenerB04F7803",
    "aiAssistantapiTaskDefTaskRoleDefaultPolicyFA1124D9",
    "aiAssistantapiTaskDefTaskRole72CFDE60"
   ],
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/Service/Service"
   }
  },
  "aiAssistantapiServiceSecurityGroupF0CEC0BC": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/Service/SecurityGroup",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "Tags": [
     {
      "Key": "BudgetId",
      "Value": "001297-04"
     },
     {
      "Key": "doNotShutDown",
      "Value": "true"
     },
     {
      "Key": "Env",
      "Value": "test"
     },
     {
      "Key": "LegalOU",
      "Value": "USA"
     },
     {
      "Key": "OrgOU",
      "Value": "GD"
     },
     {
      "Key": "Team",
      "Value": "commerceut"
     }
    ],
    "VpcId": "vpc-0531a5bc0caa4db81"
   },
   "DependsOn": [
    "aiAssistantapiTaskDefTaskRoleDefaultPolicyFA1124D9",
    "aiAssistantapiTaskDefTaskRole72CFDE60"
   ],
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/Service/SecurityGroup/Resource"
   }
  },
  "aiAssistantapiServiceSecurityGroupfromaiasstv2ecspatternsstackaiAssistantapiLBSecurityGroup495732A784430C787DBC": {
   "Type": "AWS::EC2::SecurityGroupIngress",
   "Properties": {
    "Description": "Load balancer to target",
    "FromPort": 8443,
    "GroupId": {
     "Fn::GetAtt": [
      "aiAssistantapiServiceSecurityGroupF0CEC0BC",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "SourceSecurityGroupId": {
     "Fn::GetAtt": [
      "aiAssistantapiLBSecurityGroup8AAE2195",
      "GroupId"
     ]
    },
    "ToPort": 8443
   },
   "DependsOn": [
    "aiAssistantapiTaskDefTaskRoleDefaultPolicyFA1124D9",
    "aiAssistantapiTaskDefTaskRole72CFDE60"
   ],
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/Service/SecurityGroup/from aiasstv2ecspatternsstackaiAssistantapiLBSecurityGroup495732A7:8443"
   }
  },
  "aiAssistantapiServiceTaskCountTargetEFE71C4B": {
   "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
   "Properties": {
    "MaxCapacity": 10,
    "MinCapacity": 2,
    "ResourceId": {
     "Fn::Join": [
      "",
      [
       "service/aiAssistantCluster/",
       {
        "Fn::GetAtt": [
         "aiAssistantapiService744392F3",
         "Name"
        ]
       }
      ]
     ]
    },
    "RoleARN": {
     "Fn::Join": [
      "",
      [
       "arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":iam::761615930507:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService"
      ]
     ]
    },
    "ScalableDimension": "ecs:service:DesiredCount",
    "ServiceNamespace": "ecs"
   },
   "DependsOn": [
    "aiAssistantapiTaskDefTaskRoleDefaultPolicyFA1124D9",
    "aiAssistantapiTaskDefTaskRole72CFDE60"
   ],
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/Service/TaskCount/Target/Resource"
   }
  },
  "aiAssistantapiServiceTaskCountTargetcpuscaling9086901E": {
   "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
   "Properties": {
    "PolicyName": "aiasstv2ecspatternsstackaiAssistantapiServiceTaskCountTargetcpuscaling5A555A45",
    "PolicyType": "TargetTrackingScaling",
    "ScalingTargetId": {
     "Ref": "aiAssistantapiServiceTaskCountTargetEFE71C4B"
    },
    "TargetTrackingScalingPolicyConfiguration": {
     "PredefinedMetricSpecification": {
      "PredefinedMetricType": "ECSServiceAverageCPUUtilization"
     },
     "ScaleInCooldown": 60,
     "ScaleOutCooldown": 60,
     "TargetValue": 10
    }
   },
   "DependsOn": [
    "aiAssistantapiTaskDefTaskRoleDefaultPolicyFA1124D9",
    "aiAssistantapiTaskDefTaskRole72CFDE60"
   ],
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/aiAssistant-api/Service/TaskCount/Target/cpuscaling/Resource"
   }
  },
  "CDKMetadata": {
   "Type": "AWS::CDK::Metadata",
   "Properties": {
    "Analytics": "v2:deflate64:H4sIAAAAAAAA/31STW/CMAz9LbuXbHCYtuNgH5qEtKnljkxqKkNIqjhlQlX/+9wUSrtNO9l+efbzcztTjzN1dwNfPNH5fmJoo2op1jVqr1IsHVNw/jQHxgQ1r0sIAb1l9VSWhjQEcnbpIJ+DAasxfwVfQMAM/ZG0tBjgQNoIYxMZZIvjTNV/d/tksR3XQx5xQHvmXPLB+0qUMbx5V5UtZVA2srloZqgrT+HUU/4HXgqPzL/gdxvxdiar+mx3Bbx/xi1Zajfp5MeIswFINh5gP04Vhbo00+J/Y+LYhatsaBKCg6pTZyIvxk8nzk9t2WVNYlwhKy1d0Ru65E0C10NBFRyLgnwKOUov1Z4rLjFGurDyoPfSkHV9V+0R0DRJiuwq39n5qEJZxZkXtEmsy1Ht+PY4fVDTe/nzdkw08eKRDqjSLn4DZDL7nJUCAAA="
   },
   "Metadata": {
    "aws:cdk:path": "ai-asst-v2-ecs-patterns-stack/CDKMetadata/Default"
   }
  }
 },
 "Outputs": {
  "aiAssistantapiLoadBalancerDNS0C757C3F": {
   "Value": {
    "Fn::GetAtt": [
     "aiAssistantapiLB21824883",
     "DNSName"
    ]
   }
  },
  "aiAssistantapiServiceURL14C1D153": {
   "Value": {
    "Fn::Join": [
     "",
     [
      "https://",
      {
       "Fn::GetAtt": [
        "aiAssistantapiLB21824883",
        "DNSName"
       ]
      }
     ]
    ]
   }
  }
 }
}